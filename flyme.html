<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Fly me</title>
<script src="js/prototype.js"></script>
<script>

function UFO(ctx,x,y) {
	this.ctx=ctx;
	this.x=x;
	this.y=y;
	this.path='r';
	this.multiplier = 1;
	this.moved = 0;
}


UFO.prototype = {
	setPath: function(path) {
		this.moved =1;
		this.pathBefore=this.path;
		this.path = path;
		
		if ( this.path === this.pathBefore) {
			this.multiplier+=1;
		} else {
			this.multiplier-=1;
			if (this.multiplier <= 2 ) {
				this.multiplier = 2;
			}
		}
		switch(this.path)
		{
			case 'u':
				this.y+=this.multiplier;
				break;
			case 'd':
				this.y-=this.multiplier;
				break;
			case 'l':
				this.x-=this.multiplier;
				break;		
			case 'r':
				this.x+=this.multiplier;
				break;
			default:
				break;
		}
	},
	update: function() {
		if (this.moved === 1 ) {
			this.moved =0;
		} else {
			this.multiplier-=1;
			this.setPath(this.path);
		}
	},
	draw: function() {
		this.ctx.save();
		this.ctx.translate(this.x,this.ctx.canvas.height-this.y);
		
		this.ctx.beginPath();
		
/*
Use Inkscape, set the co-ordinates then - the x axis.
*/
//		var poly=[ 0,0, 0,-40, 30,-15, 110,-15, 130,0];
		var poly=[ 0,0, 0,40, 30,15, 110,15, 130,0];
		
		this.ctx.fillStyle = '#f00';

		this.ctx.beginPath();
		
		var offSet=0;
		if (this.path === 'l') {
/*
 * This accounts for the length of the plane.
 */
			offSet+=130;	
			this.ctx.scale(-1,-1);
		} else {
			this.ctx.scale(1,-1);
		}
		
		this.ctx.moveTo(poly[0]-offSet, poly[1]);
		for( item=2 ; item < poly.length-1 ; item+=2 ){this.ctx.lineTo( poly[item]-offSet, poly[item+1] )}
		
		this.ctx.closePath();
		this.ctx.fill();

		this.ctx.restore();
		
		
	},
	fire: function() {
		console.log('fire');
	}
};

function Game(ctx) {
	this.ctx=ctx;
	this._objs = [];
	this.gameTimer=null;
	this.fps = 75; // frames per second
    this.timeInterval = null;
}

Game.prototype ={
	addObject: function(obj) {
		this._objs.push(obj);
	},
	start: function() {
		this.timeInterval = 1000 / this.fps;
		this.gameTimer = setInterval(function(){
			this.clearCanvas();
			this.updateObjects();
		}.bind(this),this.timeInterval);
	},
	pause: function() {
		if (this.gameTimer !== null )
		{
			clearInterval(this.gameTimer);
			this.gameTimer = null;
		} else {
			this.start();
		}
	},
	isPaused: function() {
		if (this.gameTimer !== null ) {
			return false;
		}
		return true;
	},
	clearCanvas: function() {
		this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);
	},
	updateObjects: function() {
		for (var i = 0; i < this._objs.length; i++) {
			this._objs[ i ].update && this._objs[ i ].update();
			this._objs[ i ].draw && this._objs[ i ].draw();
		}
	},
	end: function() {
		this.isFinished = true;
	},
	finished: function() {
		return this.isFinished;
	}
};

</script>
<script>
window.onload = function(){
    var drawingCanvas,ctx,game,plane,str;
	drawingCanvas = document.getElementById('screen');
	ctx = drawingCanvas.getContext('2d');

	game = new Game(ctx);
	
	plane = new UFO(ctx,10,10);
	game.addObject(plane);
/*

Could have an engine... power up, power down, set to 0 with to land?
*/
	document.observe('keydown',function(event){
			
		if ( event.keyCode == 80 ) {
			game.pause();
			return true;
		}
		
		if ( game.isPaused() === false) {
			switch(event.keyCode)
			{
				case Event.KEY_UP:
					plane.setPath('u');
					break;
				case Event.KEY_DOWN:
					plane.setPath('d');
					break;
				case Event.KEY_LEFT:
					plane.setPath('l');
					break;
				case Event.KEY_RIGHT:
					plane.setPath('r');
					break;			
//"."					
				case 190:
					plane.fire();
					console.log('fire');
					
					break;
//","
				case 188:
					console.log('bombs away');
					break;
			}
		}
	});
	
	
	game.start();
};
</script>
</head>
<body>
	<canvas id="screen" width="1000" height="600" style="margin: 100px 0 0 100px; ">
			You shouldnt be online!
		</canvas>
</body>
</html>